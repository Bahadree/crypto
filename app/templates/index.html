<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kripto Analiz Paneli</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #18141c 0%, #2d0036 100%) !important;
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        header {
            background: none;
            text-align: center;
            padding: 32px 0 12px 0;
        }
        header h1 {
            color: #FFD600;
            font-family: 'Orbitron', 'Montserrat', sans-serif;
            font-size: 2.7rem;
            letter-spacing: 2.5px;
            text-shadow: 0 2px 24px #2d0036, 0 0 8px #FFD600;
            margin: 0;
            font-weight: bold;
        }
        main {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(24,20,28,0.92);
            border-radius: 32px;
            box-shadow: 0 8px 48px 0 rgba(255,214,0,0.13), 0 0 0 4px #FFD600;
            padding: 38px 40px 28px 40px;
            margin-top: 24px;
            margin-bottom: 32px;
            border: 3px solid;
            border-image: linear-gradient(90deg, #FFD600, #B39DDB, #2d0036) 1;
            backdrop-filter: blur(12px);
        }
        form {
            display: flex;
            flex-wrap: wrap;
            gap: 18px 32px;
            align-items: center;
            justify-content: center;
            margin-bottom: 32px;
        }
        label {
            color: #B39DDB;
            font-weight: bold;
            font-size: 1.13rem;
            margin-bottom: 4px;
            margin-right: 8px;
        }
        select {
            background: #18141c;
            color: #FFD600;
            border: none;
            border-radius: 14px;
            font-weight: bold;
            box-shadow: 0 0 0 2px #FFD600;
            padding: 8px 18px;
            font-size: 1.08rem;
            transition: box-shadow 0.3s;
        }
        select:focus {
            outline: none;
            box-shadow: 0 0 0 3px #B39DDB;
        }
        #chart_type {
            background: #18141c;
            color: #B39DDB;
            border: none;
            border-radius: 14px;
            font-weight: bold;
            box-shadow: 0 0 0 2px #B39DDB;
            padding: 8px 18px;
            font-size: 1.08rem;
        }
        section {
            background: rgba(24,20,28,0.98);
            border-radius: 24px;
            box-shadow: 0 0 32px 0 #FFD60044, 0 0 0 4px #FFD600;
            padding: 32px 24px 24px 24px;
            margin-bottom: 24px;
        }
        h2 {
            color: #FFD600;
            font-family: 'Orbitron', 'Montserrat', sans-serif;
            font-size: 1.6rem;
            margin-bottom: 18px;
            letter-spacing: 1.2px;
            text-shadow: 0 2px 12px #2d0036, 0 0 4px #FFD600;
        }
        #price-chart {
            border-radius: 18px;
            box-shadow: 0 0 32px 0 #FFD60044, 0 0 0 2px #FFD600;
            background: rgba(24,20,28,0.98);
            margin-bottom: 12px;
        }
        #mouse-value {
            margin-top: 10px;
            color: #FFD600;
            font-weight: bold;
            min-height: 24px;
            font-size: 1.08rem;
            letter-spacing: 1.1px;
        }
        .footer {
            text-align: center;
            padding: 32px 0 18px 0;
            background: none;
            color: #FFD600;
            font-weight: bold;
            font-size: 1.08rem;
            letter-spacing: 1.2px;
            border-top: 2px solid #FFD60044;
            margin-top: 32px;
        }
        .footer .social {
            margin-bottom: 10px;
        }
        .footer .social a {
            margin: 0 8px;
            display: inline-block;
            transition: transform 0.2s;
        }
        .footer .social a:hover {
            transform: scale(1.15);
        }
        .footer .social img {
            height: 28px;
            filter: drop-shadow(0 0 4px #FFD60088);
        }
        @media (max-width: 900px) {
            main { padding: 18px 6px; }
            section { padding: 18px 6px; }
        }
        @media (max-width: 600px) {
            header h1 { font-size: 1.5rem; }
            main { padding: 8px 2px; }
            section { padding: 8px 2px; }
            form { flex-direction: column; gap: 10px 0; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Elite Crypto Panel</h1>
    </header>
    <main>
        <form method="post"></form>
            <label for="symbol">Kripto Parayı Seçin:</label>
            <select name="symbol" id="symbol" onchange="this.form.submit()">
                <option value="BTCUSDT" {% if symbol == 'BTCUSDT' or not symbol %}selected{% endif %}>Bitcoin (BTC/USDT)</option>
                <option value="ETHUSDT" {% if symbol == 'ETHUSDT' %}selected{% endif %}>Ethereum (ETH/USDT)</option>
                <option value="BNBUSDT" {% if symbol == 'BNBUSDT' %}selected{% endif %}>BNB (BNB/USDT)</option>
                <option value="SOLUSDT" {% if symbol == 'SOLUSDT' %}selected{% endif %}>Solana (SOL/USDT)</option>
                <option value="XRPUSDT" {% if symbol == 'XRPUSDT' %}selected{% endif %}>XRP (XRP/USDT)</option>
                <option value="DOGEUSDT" {% if symbol == 'DOGEUSDT' %}selected{% endif %}>Dogecoin (DOGE/USDT)</option>
                <option value="ADAUSDT" {% if symbol == 'ADAUSDT' %}selected{% endif %}>Cardano (ADA/USDT)</option>
                <option value="AVAXUSDT" {% if symbol == 'AVAXUSDT' %}selected{% endif %}>Avalanche (AVAX/USDT)</option>
                <option value="MATICUSDT" {% if symbol == 'MATICUSDT' %}selected{% endif %}>Polygon (MATIC/USDT)</option>
                <option value="LTCUSDT" {% if symbol == 'LTCUSDT' %}selected{% endif %}>Litecoin (LTC/USDT)</option>
            </select>
            <label for="interval">Zaman Aralığı:</label>
            <select name="interval" id="interval" onchange="this.form.submit()">
                <option value="1m" {% if interval == '1m' %}selected{% endif %}>1 Dakika</option>
                <option value="3m" {% if interval == '3m' %}selected{% endif %}>3 Dakika</option>
                <option value="5m" {% if interval == '5m' %}selected{% endif %}>5 Dakika</option>
                <option value="15m" {% if interval == '15m' %}selected{% endif %}>15 Dakika</option>
                <option value="30m" {% if interval == '30m' %}selected{% endif %}>30 Dakika</option>
                <option value="1h" {% if interval == '1h' %}selected{% endif %}>1 Saat</option>
                <option value="2h" {% if interval == '2h' %}selected{% endif %}>2 Saat</option>
                <option value="4h" {% if interval == '4h' %}selected{% endif %}>4 Saat</option>
                <option value="6h" {% if interval == '6h' %}selected{% endif %}>6 Saat</option>
                <option value="8h" {% if interval == '8h' %}selected{% endif %}>8 Saat</option>
                <option value="12h" {% if interval == '12h' %}selected{% endif %}>12 Saat</option>
                <option value="1d" {% if interval == '1d' or not interval %}selected{% endif %}>1 Gün</option>
                <option value="3d" {% if interval == '3d' %}selected{% endif %}>3 Gün</option>
                <option value="1w" {% if interval == '1w' %}selected{% endif %}>1 Hafta</option>
                <option value="1M" {% if interval == '1M' %}selected{% endif %}>1 Ay</option>
            </select>
            <label for="chart_type">Görüntülenecek Grafik:</label>
            <select name="chart_type" id="chart_type" onchange="this.form.submit()">
                <option value="candlestick" {% if chart_type == 'candlestick' %}selected{% endif %}>Mum Grafiği</option>
                <option value="rsi" {% if chart_type == 'rsi' %}selected{% endif %}>RSI</option>
                <option value="macd" {% if chart_type == 'macd' %}selected{% endif %}>MACD</option>
            </select>
        </form>
        <section>
            <h2>Fiyat Grafiği</h2>
            <div id="price-chart" style="height:500px;"></div>
            <div id="mouse-value"></div>
            <script type="text/javascript">
                var chartData = {{ chart_data | tojson | safe }};
                var chartType = "{{ chart_type }}";
                var traces = [];
                if (chartType === "candlestick") {
                    traces.push({
                        x: chartData.dates,
                        open: chartData.open,
                        high: chartData.high,
                        low: chartData.low,
                        close: chartData.close,
                        type: 'candlestick',
                        name: 'Fiyat',
                        increasing: {line: {color: 'green'}},
                        decreasing: {line: {color: 'red'}}
                    });
                    if (chartData.support_trend && chartData.support_trend.length > 0) {
                        traces.push({
                            x: chartData.support_trend.map(pt => new Date(pt[0] * 1000)),
                            y: chartData.support_trend.map(pt => pt[1]),
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Destek Trend Çizgisi',
                            line: {color: 'green', dash: 'dash'},
                            legendgroup: 'Destek Trend',
                            showlegend: true,
                            hovertemplate: '<b>Destek Trend Çizgisi</b><br>Tarih: %{x}<br>Fiyat: %{y:.2f}<extra></extra>'
                        });
                    }
                    if (chartData.resistance_trend && chartData.resistance_trend.length > 0) {
                        traces.push({
                            x: chartData.resistance_trend.map(pt => new Date(pt[0] * 1000)),
                            y: chartData.resistance_trend.map(pt => pt[1]),
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Direnç Trend Çizgisi',
                            line: {color: 'red', dash: 'dash'},
                            legendgroup: 'Direnç Trend',
                            showlegend: true,
                            hovertemplate: '<b>Direnç Trend Çizgisi</b><br>Tarih: %{x}<br>Fiyat: %{y:.2f}<extra></extra>'
                        });
                    }
                } else if (chartType === "rsi") {
                    traces.push({
                        x: chartData.dates,
                        y: chartData.rsi,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'RSI',
                        line: {color: 'orange'}
                    });
                } else if (chartType === "macd") {
                    traces.push({
                        x: chartData.dates,
                        y: chartData.macd,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'MACD',
                        line: {color: 'cyan'}
                    });
                    traces.push({
                        x: chartData.dates,
                        y: chartData.macd_signal,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'MACD Signal',
                        line: {color: 'magenta'}
                    });
                }
                var layout = {
                    title: chartType === "candlestick" ? 'Mum Grafiği' : (chartType === "rsi" ? 'RSI' : 'MACD'),
                    xaxis: { title: 'Tarih', rangeslider: {visible: false} },
                    yaxis: { 
                        title: chartType === "candlestick" ? 'Fiyat' : (chartType === "rsi" ? 'RSI' : 'MACD'),
                        fixedrange: false
                    },
                    dragmode: 'pan',
                    template: 'plotly_dark',
                    legend: {orientation: 'h', yanchor: 'bottom', y: 1.02, xanchor: 'right', x: 1},
                    hovermode: chartType === "candlestick" ? 'x unified' : 'closest',
                    height: 600
                };
                var config = {
                    scrollZoom: true,
                    displaylogo: false,
                    responsive: true,
                    modeBarButtonsToRemove: ['select2d', 'lasso2d']
                };
                Plotly.newPlot('price-chart', traces, layout, config);

                var priceChart = document.getElementById('price-chart');
                var mouseValueDiv = document.getElementById('mouse-value');
                var isHovering = false;

                // Dikey ve yatay çizgi için referanslar
                var vLineId = 'mouse-vline';
                var hLineId = 'mouse-hline';

                priceChart.on('plotly_hover', function() {
                    isHovering = true;
                    mouseValueDiv.innerHTML = '';
                });
                priceChart.on('plotly_unhover', function() {
                    isHovering = false;
                });

                priceChart.on('mousemove', function(evt) {
                    if (isHovering) return;
                    var boundingRect = priceChart.getBoundingClientRect();
                    var x = evt.clientX - boundingRect.left;
                    var y = evt.clientY - boundingRect.top;

                    var gd = priceChart;
                    var fullLayout = gd._fullLayout;
                    var yaxis = fullLayout.yaxis;
                    var xaxis = fullLayout.xaxis;

                    // x ekseni için index bul
                    var l = xaxis._offset || xaxis.domain[0] * boundingRect.width;
                    var w = xaxis._length || (xaxis.domain[1] - xaxis.domain[0]) * boundingRect.width;
                    var fracX = (x - l) / w;
                    if (fracX < 0 || fracX > 1) {
                        mouseValueDiv.innerHTML = '';
                        Plotly.relayout(priceChart, {shapes: []});
                        return;
                    }
                    var idx = Math.round(fracX * (chartData.dates.length - 1));
                    idx = Math.max(0, Math.min(chartData.dates.length - 1, idx));
                    var date = chartData.dates[idx];

                    // y ekseni için değer bul
                    var t = yaxis._offset || yaxis.domain[0] * boundingRect.height;
                    var h = yaxis._length || (yaxis.domain[1] - yaxis.domain[0]) * boundingRect.height;
                    var fracY = 1 - ((y - t) / h);
                    var yMin = (yaxis.range) ? yaxis.range[0] : 0;
                    var yMax = (yaxis.range) ? yaxis.range[1] : 1;
                    var yVal = yMin + fracY * (yMax - yMin);

                    // Gösterilecek değer
                    var value = '';
                    if (chartType === "candlestick") {
                        value = 'Tarih: ' + date + ' | Y: ' + yVal.toFixed(2);
                    } else if (chartType === "rsi") {
                        value = 'Tarih: ' + date + ' | Y: ' + yVal.toFixed(2);
                    } else if (chartType === "macd") {
                        value = 'Tarih: ' + date + ' | Y: ' + yVal.toFixed(2);
                    }
                    mouseValueDiv.innerHTML = value;

                    // Dikey ve yatay çizgi ekle
                    var shapes = [
                        {
                            type: 'line',
                            xref: 'x',
                            yref: 'paper',
                            x0: date,
                            x1: date,
                            y0: 0,
                            y1: 1,
                            line: {color: '#FFD600', width: 1, dash: 'dot'},
                            layer: 'above',
                            name: vLineId
                        },
                        {
                            type: 'line',
                            xref: 'paper',
                            yref: 'y',
                            x0: 0,
                            x1: 1,
                            y0: yVal,
                            y1: yVal,
                            line: {color: '#FFD600', width: 1, dash: 'dot'},
                            layer: 'above',
                            name: hLineId
                        }
                    ];
                    Plotly.relayout(priceChart, {shapes: shapes});
                });
                priceChart.on('mouseleave', function() {
                    mouseValueDiv.innerHTML = '';
                    Plotly.relayout(priceChart, {shapes: []});
                });

                priceChart.on('plotly_doubleclick', function() {
                    Plotly.relayout(priceChart, {
                        'xaxis.autorange': true,
                        'yaxis.autorange': true
                    });
                });
            </script>
        </section>
    </main>
    <footer class="footer">
        <div class="social">
            <a href="https://twitter.com/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" alt="Twitter"></a>
            <a href="https://github.com/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="GitHub"></a>
            <a href="https://linkedin.com/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="LinkedIn"></a>
        </div>
        <div style="height:2px;width:120px;background:linear-gradient(90deg,#FFD600,#B39DDB,#2d0036);margin:0 auto 8px auto;border-radius:2px"></div>
        <p>Elite Crypto Panel | 2025</p>
    </footer>
</body>
</html>