<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Kripto Haberler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', 'Segoe UI', sans-serif;
      background-color: #000;
      color: #fff;
      margin: 0;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: #000;
      border-bottom: 1px solid #111;
    }
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      letter-spacing: 1px;
    }
    nav a {
      margin: 0 1rem;
      color: #ccc;
      text-decoration: none;
      font-weight: 500;
      font-family: 'Montserrat', sans-serif;
    }
    nav a:hover {
      color: #fff;
    }
    .signup-btn {
      background-color: #FFD700;
      color: #000;
      padding: 0.5rem 1.2rem;
      border: none;
      border-radius: 999px;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      transition: background 0.2s, color 0.2s;
    }
    .signup-btn:hover {
      background: #fff;
      color: #FFD700;
    }
    .news-main {
      max-width: 800px;
      margin: 40px auto;
      background: #111;
      border-radius: 18px;
      box-shadow: 0 2px 16px #FFD70022;
      padding: 36px 32px;
    }
    .news-title {
      font-size: 2rem;
      text-align: center;
      color: #FFD700;
      margin-bottom: 24px;
    }
    .news-list {
      list-style: none;
      padding: 0;
    }
    .news-item {
      margin-bottom: 28px;
      padding-bottom: 18px;
      border-bottom: 1px solid #FFD70033;
    }
    .news-item:last-child {
      border-bottom: none;
    }
    .news-item-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: #FFD700;
      margin-bottom: 6px;
    }
    .news-item-summary {
      font-size: 1.05rem;
      color: #ccc;
      margin-bottom: 8px;
    }
    .news-item-link {
      color: #FFD700;
      text-decoration: underline;
      font-size: 1rem;
    }
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        padding: 1rem 0.5rem;
      }
      nav a {
        margin: 0 0.5rem;
      }
      .news-main {
        max-width: 96vw;
        padding: 18px 16px;
      }
      .news-title {
        font-size: 1.3rem;
      }
      .news-item-title {
        font-size: 1.1rem;
      }
      .news-item-summary {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Elite Crypto Panel</div>
    <nav>
      <a href="{{ url_for('main.analysis') }}" class="nav-link" data-vip="1">Analiz</a>
      <a href="{{ url_for('main.news') }}" class="nav-link" data-vip="1" style="color:#FFD700;">Haberler</a>
      <a href="{{ url_for('main.market_comment') }}" class="nav-link" data-vip="1" id="market-comment-link">Piyasa Yorumu</a>
      {% if not session.get('is_vip') %}
      <a href="{{ url_for('main.buy') }}" class="nav-link" data-vip="0">VIP Satın Al</a>
      {% endif %}
    </nav>
    {% if session.get('user_email') %}
    <div style="position:relative;display:inline-block;">
      <button id="user-menu-btn" style="background:rgba(255,214,0,0.12);color:#FFD700;font-weight:bold;font-size:1.08rem;font-family:'Montserrat',sans-serif;border:2px solid #FFD700;border-radius:8px;padding:7px 18px;cursor:pointer;backdrop-filter:blur(2px);transition:background 0.2s;">
        {{ session.get('user_email') }}
      </button>
      <div id="user-menu-dropdown" style="display:none;position:absolute;right:0;top:110%;background:rgba(24,20,28,0.98);border:1.5px solid #FFD600;border-radius:12px;box-shadow:0 4px 24px #FFD60022;min-width:180px;z-index:9999;">
        <a href="{{ url_for('main.index') }}" style="display:block;padding:12px 18px;color:#FFD600;font-family:'Montserrat',sans-serif;text-decoration:none;font-size:1.05rem;border-bottom:1px solid #FFD60022;">Anasayfa</a>
        <a href="{{ url_for('main.buy') }}" style="display:block;padding:12px 18px;color:#FFD600;font-family:'Montserrat',sans-serif;text-decoration:none;font-size:1.05rem;border-bottom:1px solid #FFD60022;">VIP Satın Al</a>
        <a href="{{ url_for('main.logout') }}" id="logout-link" style="display:block;padding:12px 18px;color:#ff1744;font-family:'Montserrat',sans-serif;text-decoration:none;font-size:1.05rem;">Çıkış Yap</a>
      </div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var btn = document.getElementById('user-menu-btn');
      var menu = document.getElementById('user-menu-dropdown');
      if (btn && menu) {
        btn.onclick = function(e) {
          e.stopPropagation();
          menu.style.display = (menu.style.display === "block") ? "none" : "block";
        };
        document.addEventListener('mousedown', function(e) {
          if (!menu.contains(e.target) && e.target !== btn) {
            menu.style.display = "none";
          }
        });
      }
    });
    </script>
    {% else %}
      <a href="{{ url_for('main.login') }}"><button class="signup-btn">Giriş Yap</button></a>
    {% endif %}
  </header>
  <div style="text-align:center;color:#FFD700;font-size:1.25rem;font-weight:bold;margin-top:12px;margin-bottom:0;">
    {{ selected_coin.name if selected_coin else symbol }}
  </div>

  <!-- Koin seçme menüsü (sidebar ve buton) -->
  <button id="open-sidebar-btn" style="position:fixed;top:120px;left:0;z-index:1001;background:#FFD700;color:#18141c;font-weight:bold;border:none;border-radius:0 12px 12px 0;padding:16px 12px 16px 6px;cursor:pointer;box-shadow:2px 2px 12px #FFD70044;">&#9776; Kripto Seç</button>
  <aside id="crypto-sidebar" style="width: 320px; min-width: 220px; background: rgba(24,20,28,0.98); border-radius: 0 18px 18px 0; box-shadow: 2px 0 16px #FFD60022; padding: 28px 18px 24px 18px; position:fixed; top:0; left:0; height:100vh; z-index:1002; display:none; overflow-y:auto; transform:scale(0.7) rotateY(45deg); opacity:0; transition:all 0.5s cubic-bezier(.22,1.5,.36,1); scrollbar-width: thin; scrollbar-color: #FFD700 #18141c;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
      <span style="color:#FFD600;font-size:1.18rem;font-weight:bold;">Kripto Seçimi</span>
      <button id="close-sidebar-btn" style="background:none;border:none;color:#FFD600;font-size:1.5rem;cursor:pointer;">&times;</button>
    </div>
    <div style="width:100%;display:flex;justify-content:center;">
      <input type="text" id="coin-search" placeholder="Kripto ara..." style="margin-bottom:14px;padding:8px 12px;border-radius:8px;border:1px solid #FFD600;width:90%;background:#18141c;color:#FFD600;font-size:1rem;display:block;">
    </div>
    <form method="post" id="main-form" style="display: flex; flex-direction: column; gap: 18px;">
      <input type="hidden" name="hidden_symbol" id="hidden_symbol" value="{{ symbol }}">
      {% set selected_coin = coins | selectattr('symbol', 'equalto', symbol) | list | first %}
      {% if selected_coin %}
      <div id="selected-coin" style="display:flex;justify-content:center;margin-bottom:12px;">
        <button type="submit" name="symbol" value="{{ selected_coin.symbol }}"
          class="coin-btn"
          style="background:#FFD600;color:#18141c;border:2px solid #FFD600;border-radius:12px;padding:12px 24px;font-weight:bold;cursor:pointer;box-shadow:0 0 16px #FFD60088;display:flex;align-items:center;gap:5px;font-size:1.08rem;">
          <span>{{ selected_coin.name }}</span>
          {% if selected_coin.symbol in favorite_symbols %}
            <span class="fav-toggle" data-symbol="{{ selected_coin.symbol }}" data-fav="1" style="margin-left:4px;color:#18141c;font-size:1.2em;cursor:pointer;">★</span>
          {% else %}
            <span class="fav-toggle" data-symbol="{{ selected_coin.symbol }}" data-fav="0" style="margin-left:4px;color:#00e676;font-size:1.2em;cursor:pointer;">☆</span>
          {% endif %}
        </button>
      </div>
      {% endif %}
      <div id="favorite-coins" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom:10px; justify-content: center;">
        {% for coin in coins if coin.symbol in favorite_symbols and coin.symbol != symbol %}
        <button type="submit" name="symbol" value="{{ coin.symbol }}"
          class="coin-btn favorite-coin"
          style="background:#00e676;color:#18141c;border:2px solid #00e676;border-radius:10px;padding:10px 18px 10px 18px;font-weight:bold;cursor:pointer;position:relative;display:flex;align-items:center;gap:3px;"
        >
          <span>{{ coin.name }}</span>
          <span class="fav-toggle" data-symbol="{{ coin.symbol }}" data-fav="1" style="margin-left:4px;color:#18141c;font-size:1.1em;cursor:pointer;">★</span>
        </button>
        {% endfor %}
      </div>
      <div id="coin-buttons" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
        {% for coin in coins if coin.symbol not in favorite_symbols and coin.symbol != symbol %}
        <button type="submit" name="symbol" value="{{ coin.symbol }}"
          class="coin-btn"
          style="background:#18141c;color:#FFD600;border:2px solid #FFD600;border-radius:10px;padding:10px 18px 10px 18px;font-weight:bold;cursor:pointer;position:relative;display:flex;align-items:center;gap:3px;transition:background 0.2s;"
        >
          <span>{{ coin.name }}</span>
          <span class="fav-toggle" data-symbol="{{ coin.symbol }}" data-fav="0" style="margin-left:4px;color:#00e676;font-size:1.1em;cursor:pointer;">☆</span>
        </button>
        {% endfor %}
      </div>
    </form>
    <style>
      #crypto-sidebar::-webkit-scrollbar {
        width: 8px;
        background: #18141c;
        border-radius: 8px;
      }
      #crypto-sidebar::-webkit-scrollbar-thumb {
        background: #FFD700;
        border-radius: 8px;
      }
      #crypto-sidebar::-webkit-scrollbar-thumb:hover {
        background: #ffe066;
      }
    </style>
  </aside>

  <div class="news-main">
    <div class="news-title">Kripto Haberler</div>
    <ul class="news-list">
      {% if news_list and news_list|length > 0 %}
        {% for news in news_list %}
        <li class="news-item">
          <div class="news-item-title">{{ news.title }}</div>
          <div class="news-item-summary">{{ news.summary }}</div>
          <a class="news-item-link" href="{{ news.url }}" target="_blank">Haberi Oku</a>
        </li>
        {% endfor %}
      {% else %}
        <li class="news-item">
          <div class="news-item-title">Haber bulunamadı.</div>
          <div class="news-item-summary">Şu anda gösterilecek haber yok.</div>
        </li>
      {% endif %}
    </ul>
  </div>

  <!-- Gerekirse bu alana header/sidebar/logout modal gibi yapılar da düzgün şekilde entegre edilebilir -->

  <!-- JS KISMI -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var isVip = {{ 'true' if session.get('is_vip') else 'false' }};
      var isLoggedIn = {{ 'true' if session.get('user_email') else 'false' }};
      document.querySelectorAll('.nav-link[data-vip="1"]').forEach(function(link) {
        link.addEventListener('click', function(e) {
          if (!isLoggedIn) {
            e.preventDefault();
            window.location.href = "{{ url_for('main.login') }}";
            return;
          }
          if (!isVip) {
            e.preventDefault();
            window.location.href = "{{ url_for('main.buy') }}";
            return;
          }
          // VIP ve login ise hiçbir şekilde e.preventDefault() veya window.location.href kullanma!
          // <a> kendi href'ine yönlendirir.
        });
      });
      // Koin seçme menüsü (sidebar ve buton) ile ilgili kodlar
      document.addEventListener("DOMContentLoaded", function() {
        var sidebar = document.getElementById('crypto-sidebar');
        var openBtn = document.getElementById('open-sidebar-btn');
        var closeBtn = document.getElementById('close-sidebar-btn');
        if (openBtn && sidebar) {
          openBtn.addEventListener('click', function() {
            sidebar.style.display = "block";
            sidebar.style.transition = "none";
            sidebar.style.transform = "scale(0.7) rotateY(45deg)";
            sidebar.style.opacity = "0";
            void sidebar.offsetWidth;
            sidebar.style.transition = "all 0.5s cubic-bezier(.22,1.5,.36,1)";
            sidebar.style.transform = "scale(1) rotateY(0deg)";
            sidebar.style.opacity = "1";
          });
        }
        if (closeBtn && sidebar) {
          closeBtn.addEventListener('click', function() {
            sidebar.style.transform = "scale(0.7) rotateY(45deg)";
            sidebar.style.opacity = "0";
            setTimeout(function(){ sidebar.style.display = "none"; }, 500);
          });
        }
        document.addEventListener('mousedown', function(e) {
          if (sidebar.style.transform === "scale(1) rotateY(0deg)" && !sidebar.contains(e.target) && e.target !== openBtn) {
            sidebar.style.transform = "scale(0.7) rotateY(45deg)";
            sidebar.style.opacity = "0";
            setTimeout(function(){ sidebar.style.display = "none"; }, 500);
          }
        });
        // Arama özelliği
        var searchInput = document.getElementById('coin-search');
        var coinButtonsDiv = document.getElementById('coin-buttons');
        if (searchInput && coinButtonsDiv) {
          searchInput.addEventListener('input', function() {
            var filter = searchInput.value.toLowerCase();
            var buttons = coinButtonsDiv.querySelectorAll('.coin-btn');
            buttons.forEach(function(btn) {
              var text = btn.textContent.toLowerCase();
              btn.style.display = text.includes(filter) ? '' : 'none';
            });
          });
        }
        // Favori ekleme/çıkarma (tek yıldız ile)
        document.querySelectorAll('.fav-toggle').forEach(function(star) {
          star.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            var symbol = this.getAttribute('data-symbol');
            fetch('/favorite', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({symbol: symbol})
            })
            .then(resp => resp.json())
            .then(function(data) {
              if(data.success) {
                updateFavoritesUI(symbol);
              }
            });
          });
        });

        function updateFavoritesUI(symbol) {
          var favBtn = document.querySelector('.fav-toggle[data-symbol="' + symbol + '"]');
          if (!favBtn) return;
          var parentBtn = favBtn.closest('button');
          var selectedCoinDiv = document.getElementById('selected-coin');
          var favList = document.getElementById('favorite-coins');
          var coinList = document.getElementById('coin-buttons');
          var isSelected = selectedCoinDiv && selectedCoinDiv.contains(parentBtn);
          var isFav = favBtn.getAttribute('data-fav') === "1";
          if (isSelected) {
            if (isFav) {
              favBtn.innerText = "☆";
              favBtn.style.color = "#00e676";
              favBtn.setAttribute('data-fav', "0");
            } else {
              favBtn.innerText = "★";
              favBtn.style.color = "#18141c";
              favBtn.setAttribute('data-fav', "1");
            }
          } else {
            if (isFav) {
              favBtn.innerText = "☆";
              favBtn.style.color = "#00e676";
              favBtn.setAttribute('data-fav', "0");
              parentBtn.classList.remove('favorite-coin');
              parentBtn.style.background = "#18141c";
              parentBtn.style.color = "#FFD600";
              parentBtn.style.border = "2px solid #FFD600";
              coinList.appendChild(parentBtn);
            } else {
              favBtn.innerText = "★";
              favBtn.style.color = "#18141c";
              favBtn.setAttribute('data-fav', "1");
              parentBtn.classList.add('favorite-coin');
              parentBtn.style.background = "#00e676";
              parentBtn.style.color = "#18141c";
              parentBtn.style.border = "2px solid #00e676";
              favList.appendChild(parentBtn);
            }
          }
        }
      });
    });
  </script>

  <!-- Home'daki footer başlıyor -->
  <footer style="background:#000; color:#FFD700; text-align:center; padding:48px 0 24px 0; font-family:'Montserrat',sans-serif; border-top:2px solid #FFD60044; margin-top:48px;">
    <div style="display:flex; flex-wrap:wrap; justify-content:space-evenly; gap:96px; max-width:1600px; margin:0 auto 24px auto;">
      <!-- Platform -->
      <div style="min-width:180px; margin-bottom:28px;">
        <h4 style="font-size:15px; color:#888; text-transform:uppercase; margin-bottom:18px; letter-spacing:2px;">Platform</h4>
        <ul style="list-style:none; padding:0; margin:0;">
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.analysis') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Analiz</a></li>
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.news') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Haberler</a></li>
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.market_comment') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Piyasa Yorumu</a></li>
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.buy') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">VIP Satın Al</a></li>
          <li><a href="mailto:destek@elitecryptopanel.com" style="color:#ddd; text-decoration:none; font-size:1.08rem;">İletişim</a></li>
        </ul>
      </div>
      <!-- Compliance -->
      <div style="min-width:180px; margin-bottom:28px;">
        <h4 style="font-size:15px; color:#888; text-transform:uppercase; margin-bottom:18px; letter-spacing:2px;">Yasal</h4>
        <ul style="list-style:none; padding:0; margin:0;">
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.terms') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Kullanım Şartları</a></li>
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.terms') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Gizlilik</a></li>
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.terms') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Çerezler</a></li>
          <li style="margin-bottom:16px;"><a href="{{ url_for('main.kvkk') }}" style="color:#ddd; text-decoration:none; font-size:1.08rem;">KVKK/GDPR</a></li>
          <li><a href="mailto:destek@elitecryptopanel.com" style="color:#ddd; text-decoration:none; font-size:1.08rem;">Destek</a></li>
        </ul>
      </div>
    </div>
    <div style="display:flex; flex-direction:column; align-items:center; gap:12px; margin-top:24px;">
      <div style="display:flex; align-items:center; gap:8px; font-weight:500;">
        <div style="width:32px; height:32px; background:#fff; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#000; font-weight:bold; font-size:1.3rem;">★</div>
        <span style="letter-spacing:0.5px; font-size:1.12rem; color:#FFD700;">CRYPTO ANALYSIS</span>
      </div>
      <small style="color:#777; font-size:1.01rem;">Tüm Hakları Saklıdır © 2025 Crypto Analysis</small>
    </div>
    <div style="margin-top:18px;">
      <a href="#" style="margin:0 24px;display:inline-block;">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons/icons/facebook.svg" alt="Facebook" style="width:32px;filter:invert(100%) brightness(100%);">
      </a>
      <a href="#" style="margin:0 24px;display:inline-block;">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons/icons/instagram.svg" alt="Instagram" style="width:32px;filter:invert(100%) brightness(100%);">
      </a>
      <a href="#" style="margin:0 24px;display:inline-block;">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons/icons/x.svg" alt="X" style="width:32px;filter:invert(100%) brightness(100%);">
      </a>
      <a href="#" style="margin:0 24px;display:inline-block;">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons/icons/linkedin.svg" alt="LinkedIn" style="width:32px;filter:invert(100%) brightness(100%);">
      </a>
      <a href="#" style="margin:0 24px;display:inline-block;">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons/icons/youtube.svg" alt="YouTube" style="width:32px;filter:invert(100%) brightness(100%);">
      </a>
    </div>
  </footer>
</body>
</html>
